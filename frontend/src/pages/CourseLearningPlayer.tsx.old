import { useState, useEffect, useRef } from "react";
import QuizEngine from "@/components/academy/QuizEngine";
import { getCourseById, getModulesByCourseId } from "@/data/academy/courses";
import CertificateViewer from "@/components/academy/CertificateViewer";
import { useNavigate, useParams, useSearchParams } from "react-router-dom";
import { 
  Play, Pause, SkipBack, SkipForward, Volume2, VolumeX,
  Maximize, Minimize, Settings, CheckCircle2, Circle, Lock, ChevronLeft,
  ChevronRight, BookOpen, Clock, Award, MessageSquare, Download,
  FileText, Menu, X, ChevronDown, ChevronUp, Loader2,
  ThumbsUp, ThumbsDown, Share2, Bookmark, RotateCcw, PlayCircle,
  List, Grid, Home, HelpCircle, Brain, Crown, Gift, Trophy,
  Sparkles, GraduationCap, Target, Zap,
  Bot, User, Briefcase, FlaskConical  
} from "lucide-react";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Progress } from "@/components/ui/progress";
import { Slider } from "@/components/ui/slider";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Textarea } from "@/components/ui/textarea";
import { renderMarkdownBlock } from "@/utils/markdownRenderer";
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from "@/components/ui/dialog";
import { useLanguage } from "@/contexts/LanguageContext";
import { useToast } from "@/hooks/use-toast";
import { useAcademyUser } from "@/hooks/useAcademyUser";
import { usePageTranslations } from '@/hooks/usePageTranslations';
import AiCoachPanel from "@/components/academy/AiCoachPanel";

// ============================================
// BRAND COLORS
// ============================================
const BRAND = {
  purple: '#8B5CF6',
  purpleDark: '#7C3AED',
  pink: '#D946EF',
  pinkLight: '#F0ABFC',
  green: '#22C55E',
  greenDark: '#16A34A',
  blue: '#3B82F6',
  orange: '#F59E0B',
};

// ============================================
// LOGO COMPONENT
// ============================================
const ProjeXtPalLogo = ({ size = 'sm' }: { size?: 'sm' | 'md' | 'lg' }) => {
  const { pt } = usePageTranslations();
  const sizes = {
    sm: { width: 40, height: 16, text: 'text-base', gap: 'gap-1.5' },
    md: { width: 48, height: 20, text: 'text-lg', gap: 'gap-2' },
    lg: { width: 64, height: 26, text: 'text-xl', gap: 'gap-3' },
  };
  
  const { width, height, text, gap } = sizes[size];

  return (
    <div className={`flex items-center ${gap}`}>
      <svg width={width} height={height} viewBox="0 0 2078 1008" fill="none" className="shrink-0">
        <defs>
          <linearGradient id={`xGrad-player-${size}`} x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stopColor={BRAND.pink} />
            <stop offset="100%" stopColor={BRAND.pinkLight} />
          </linearGradient>
        </defs>
        <rect fill={BRAND.green} y="778" width="215" height="230" rx="30" />
        <text x="107" y="920" textAnchor="middle" fill="white" fontSize="110" fontWeight="800" fontFamily="Inter, system-ui, sans-serif">AI</text>
        <path fill="currentColor" d="M487,0H0V216H487c84,0,152,68,152,152s-68,152-152,152H0V736H487c203,0,368-165,368-368S690,0,487,0Z" />
        <polygon fill="currentColor" points="1656 586 1497 746 1383 631 1337 586 1383 540 1497 426 1656 586" />
        <polygon fill="currentColor" points="2078 1008 1759 1008 1542 791 1702 631 2078 1008" />
        <polygon fill="currentColor" points="2020 222 1702 540 1542 381 1701 222 2020 222" />
        <polygon fill={`url(#xGrad-player-${size})`} points="1656 586 1235 1008 915 1008 1337 586 973 222 1292 222 1656 586" />
      </svg>
      <span className={`font-bold ${text}`}>
        Proje<span style={{ color: BRAND.pink }}>X</span>tPal
      </span>
    </div>
  );
};

// ============================================
// COURSE DATA INTERFACE
// ============================================
interface Lesson {
  id: string;
  title: string;
  duration: string;
  videoUrl?: string;
  type?: 'video' | 'quiz' | 'assignment' | 'exam' | 'certificate';
  resources?: { name: string; type: string; size: string; url?: string }[];
  transcript?: string;
  keyTakeaways?: string[];
}

interface Module {
  id: string;
  title: string;
  lessons: Lesson[];
}

interface CourseData {
  id: string;
  title: string;
  icon: any;
  color: string;
  gradient: string;
  modules: Module[];
  totalLessons: number;
  totalDuration: string;
}

// ============================================
// IMPROVED LESSON CONTENT MODAL
// ============================================
interface LessonContentModalProps {
  isOpen: boolean;
  onClose: () => void;
  lesson: Lesson;
  courseTitle: string;
  onPrevLesson?: () => void;
  onNextLesson?: () => void;
  hasNextLesson?: boolean;
  hasPrevLesson?: boolean;
}

const LessonContentModal = ({ 
  isOpen, 
  onClose, 
  lesson, 
  courseTitle,
  onPrevLesson,
  onNextLesson,
  hasNextLesson = false,
  hasPrevLesson = false
}: LessonContentModalProps) => {
  const [activeTab, setActiveTab] = useState('overview');

  // Methodologies data
  const methodologies = [
    { 
      emoji: 'üåä', 
      name: 'Waterfall', 
      subtitle: 'Traditioneel', 
      description: 'Sequentieel: fasen volgen elkaar lineair op - Veel upfront planning en documentatie - Ideaal voor: stabiele requirements, gereguleerde omgevingen, bouw', 
      tags: ['Stabiele requirements', 'Gereguleerde omgevingen'], 
      gradient: 'from-blue-500 to-cyan-500'
    },
    { 
      emoji: '‚ö°', 
      name: 'Agile', 
      subtitle: 'Iteratief', 
      description: 'Iteratief en incrementeel - Flexibel, omarmt verandering - Frequente oplevering van werkende producten - Ideaal voor: software development, veranderende requirements', 
      tags: ['Software development', 'Veranderende requirements'], 
      gradient: 'from-green-500 to-emerald-500'
    },
    { 
      emoji: 'üéØ', 
      name: 'Scrum', 
      subtitle: 'Agile Framework', 
      description: 'Specifiek Agile framework - Vaste rollen (Product Owner, Scrum Master, Team) - Sprints van 1-4 weken - Ideaal voor: productontwikkeling, innovatie', 
      tags: ['Productontwikkeling', 'Innovatie'], 
      gradient: 'from-purple-500 to-pink-500'
    },
    { 
      emoji: 'üìä', 
      name: 'Kanban', 
      subtitle: 'Flow-based', 
      description: 'Focus op flow en visualisatie - WIP-limieten (Work In Progress) - Continue flow in plaats van sprints - Ideaal voor: operations, support, maintenance', 
      tags: ['Operations', 'Support', 'Maintenance'], 
      gradient: 'from-cyan-500 to-blue-500'
    },
    { 
      emoji: 'üëë', 
      name: 'PRINCE2', 
      subtitle: 'Procesgebaseerd', 
      description: 'Procesgebaseerde methodologie uit het VK - Duidelijke rollen en verantwoordelijkheden - Stage-gates voor beslismomenten - Ideaal voor: overheid, governance-focus', 
      tags: ['Overheid', 'Governance-focus'], 
      gradient: 'from-indigo-500 to-purple-500'
    },
    { 
      emoji: 'üìà', 
      name: 'Lean Six Sigma', 
      subtitle: 'Procesverbetering', 
      description: 'Focus op procesverbetering - DMAIC cyclus (Define, Measure, Analyze, Improve, Control) - Data-gedreven besluitvorming - Ideaal voor: procesoptimalisatie, kwaliteit', 
      tags: ['Procesoptimalisatie', 'Kwaliteit'], 
      gradient: 'from-orange-500 to-red-500'
    },
  ];

  const isMethodologyLesson = lesson.title?.toLowerCase().includes('methodologie');
  const keyTakeaways = lesson.keyTakeaways || [];

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-5xl max-h-[90vh] overflow-hidden p-0">
        <DialogTitle className="sr-only">{lesson.title}</DialogTitle>
        <DialogDescription className="sr-only">
          Lesinhoud voor {lesson.title}
        </DialogDescription>
        {/* Header met gradient */}
        <div className="bg-gradient-to-r from-purple-600 via-pink-600 to-purple-600 p-6">
          <div className="flex items-center justify-between">
            <div className="flex-1">
              <p className="text-purple-100 text-sm font-medium mb-1 flex items-center gap-2">
                <Play className="w-3 h-3" />
                {courseTitle}
              </p>
              <h2 className="text-white text-2xl font-bold">{lesson.title}</h2>
              <div className="flex items-center gap-3 mt-3">
                <Badge className="bg-white/20 text-white border-0 hover:bg-white/30">
                  <FileText className="w-3 h-3 mr-1" />
                  Transcript
                </Badge>
              </div>
            </div>
            <button 
              onClick={onClose}
              className="text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>

        {/* Tabs */}
        <div className="border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50">
          <div className="flex gap-1 px-6">
            <button
              onClick={() => setActiveTab('overview')}
              className={`py-3 px-4 font-medium text-sm border-b-2 transition-colors ${
                activeTab === 'overview'
                  ? 'border-purple-600 text-purple-600 dark:text-purple-400'
                  : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
              }`}
            >
              üìù Overzicht
            </button>
            {lesson.transcript && (
              <button
                onClick={() => setActiveTab('transcript')}
                className={`py-3 px-4 font-medium text-sm border-b-2 transition-colors ${
                  activeTab === 'transcript'
                    ? 'border-purple-600 text-purple-600 dark:text-purple-400'
                    : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                <FileText className="w-4 h-4 inline mr-1" />
                Transcript
              </button>
            )}
            {keyTakeaways.length > 0 && (
              <button
                onClick={() => setActiveTab('takeaways')}
                className={`py-3 px-4 font-medium text-sm border-b-2 transition-colors ${
                  activeTab === 'takeaways'
                    ? 'border-purple-600 text-purple-600 dark:text-purple-400'
                    : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
                }`}
              >
                ‚ú® Key Takeaways
              </button>
            )}
          </div>
        </div>

        {/* Content */}
        <div className="overflow-y-auto max-h-[calc(90vh-220px)] p-6">
          {/* Overview Tab */}
          {activeTab === 'overview' && (
            <div className="space-y-6">
              {/* Intro */}
              {lesson.transcript && (
                <div className="bg-purple-50 dark:bg-purple-900/20 border border-purple-100 dark:border-purple-800 rounded-xl p-5">
                  <p className="text-gray-700 dark:text-gray-300 leading-relaxed">
                    {lesson.transcript.split('\n\n')[0]}
                  </p>
                </div>
              )}

              {/* Methodologies Cards */}
              {isMethodologyLesson && (
                <div>
                  <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                    <Target className="w-5 h-5 text-purple-600" />
                    üéØ De Belangrijkste Methodologie√´n
                  </h3>
                  
                  <div className="space-y-3">
                    {methodologies.map((method, i) => (
                      <div 
                        key={i}
                        className="group bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:border-purple-300 dark:hover:border-purple-600 hover:shadow-lg transition-all"
                      >
                        <div className="flex items-start gap-4">
                          <div className={`bg-gradient-to-br ${method.gradient} rounded-xl p-3 shadow-lg group-hover:scale-110 transition-transform`}>
                            <span className="text-2xl">{method.emoji}</span>
                          </div>
                          <div className="flex-1">
                            <div className="flex items-baseline gap-2 mb-1">
                              <h4 className="font-bold text-gray-900 dark:text-white text-lg">
                                {i + 1}. {method.name}
                              </h4>
                              <span className="text-xs text-gray-500 dark:text-gray-400">
                                ({method.subtitle})
                              </span>
                            </div>
                            <p className="text-sm text-gray-600 dark:text-gray-400 mb-3 leading-relaxed">
                              {method.description}
                            </p>
                            <div className="flex flex-wrap gap-2">
                              {method.tags.map((tag, j) => (
                                <span 
                                  key={j}
                                  className="text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 py-1.5 rounded-full font-medium"
                                >
                                  {tag}
                                </span>
                              ))}
                            </div>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {/* Decision Framework */}
              {isMethodologyLesson && (
                <div className="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-2 border-purple-200 dark:border-purple-800 rounded-xl p-6 shadow-sm">
                  <h4 className="font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2 text-lg">
                    <span>ü§î</span> Welke Methodologie Kiezen?
                  </h4>
                  <div className="space-y-3 text-sm text-gray-700 dark:text-gray-300">
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 rounded-full bg-purple-200 dark:bg-purple-800 flex items-center justify-center shrink-0 mt-0.5">
                        <span className="text-xs font-bold text-purple-700 dark:text-purple-300">1</span>
                      </div>
                      <p><strong>Projecttype en industrie</strong> - Wat voor soort project is het?</p>
                    </div>
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 rounded-full bg-purple-200 dark:bg-purple-800 flex items-center justify-center shrink-0 mt-0.5">
                        <span className="text-xs font-bold text-purple-700 dark:text-purple-300">2</span>
                      </div>
                      <p><strong>Requirements stabiliteit</strong> - Hoe zeker zijn de requirements?</p>
                    </div>
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 rounded-full bg-purple-200 dark:bg-purple-800 flex items-center justify-center shrink-0 mt-0.5">
                        <span className="text-xs font-bold text-purple-700 dark:text-purple-300">3</span>
                      </div>
                      <p><strong>Organisatiecultuur</strong> - Past het bij je organisatie?</p>
                    </div>
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 rounded-full bg-purple-200 dark:bg-purple-800 flex items-center justify-center shrink-0 mt-0.5">
                        <span className="text-xs font-bold text-purple-700 dark:text-purple-300">4</span>
                      </div>
                      <p><strong>Team ervaring</strong> - Heeft het team de juiste skills?</p>
                    </div>
                    <div className="flex items-start gap-3">
                      <div className="w-6 h-6 rounded-full bg-purple-200 dark:bg-purple-800 flex items-center justify-center shrink-0 mt-0.5">
                        <span className="text-xs font-bold text-purple-700 dark:text-purple-300">5</span>
                      </div>
                      <p><strong>Regelgeving en compliance</strong> - Zijn er wettelijke eisen?</p>
                    </div>
                  </div>
                </div>
              )}
            </div>
          )}

          {/* Transcript Tab */}
          {activeTab === 'transcript' && lesson.transcript && (
            <div className="space-y-4">
              <div className="prose prose-sm dark:prose-invert max-w-none">
                {lesson.transcript.split('\n\n').map((paragraph, i) => (
                  <div key={i} className="mb-4 last:mb-0">
                    <p className="text-gray-700 dark:text-gray-300 leading-relaxed">
                      {paragraph}
                    </p>
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* Key Takeaways Tab */}
          {activeTab === 'takeaways' && keyTakeaways.length > 0 && (
            <div className="space-y-3">
              <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                <Sparkles className="w-5 h-5 text-purple-600" />
                Belangrijkste Punten
              </h3>
              {keyTakeaways.map((takeaway, i) => (
                <div 
                  key={i} 
                  className="flex items-start gap-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-xl hover:shadow-md transition-all group"
                >
                  <div className="w-8 h-8 rounded-full bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center shrink-0 shadow-lg group-hover:scale-110 transition-transform">
                    <CheckCircle2 className="h-4 w-4 text-white" />
                  </div>
                  <span className="text-sm text-gray-700 dark:text-gray-300 leading-relaxed pt-1">
                    {takeaway}
                  </span>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Footer with Navigation */}
        <div className="border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 px-6 py-4">
          <div className="flex items-center justify-between">
            <Button 
              variant="outline"
              onClick={onPrevLesson}
              disabled={!hasPrevLesson}
              className="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
            >
              <ChevronLeft className="w-4 h-4 mr-1" />
              Vorige les
            </Button>
            <Button 
              variant="ghost"
              onClick={onClose}
              className="text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"
            >
              Sluiten
            </Button>
            <Button 
              onClick={onNextLesson}
              disabled={!hasNextLesson}
              className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white"
            >
              Volgende les
              <ChevronRight className="w-4 h-4 ml-1" />
            </Button>
          </div>
        </div>
      </DialogContent>
    </Dialog>
  );
};

// ===================================
/** Calculate the absolute lesson number across all modules */
const getLessonGlobalIndex = (modules: Module[], lessonId: string): number => {
  let count = 0;
  for (const mod of modules) {
    for (const les of mod.lessons) {
      count++;
      if (les.id === lessonId) return count;
    }
  }
  return 0;
};

// ===================================
const getCourseData = (id: string, isNL: boolean): CourseData => {
  // Load from static course data
  const staticCourse = getCourseById(id);
  const staticModules = getModulesByCourseId(id);
  
  const BRAND = { purple: '#7C3AED', purpleDark: '#5B21B6' };
  const sampleVideoUrl = 'https://www.w3schools.com/html/mov_bbb.mp4';
  
  if (staticCourse && staticModules.length > 0) {
    return {
      id,
      title: isNL && staticCourse.titleNL ? staticCourse.titleNL : staticCourse.title,
      icon: Target,
      gradient: staticCourse.gradient || `linear-gradient(135deg, ${BRAND.purple}, ${BRAND.purpleDark})`,
      totalLessons: staticModules.reduce((sum, m) => sum + (m.lessons?.length || 0), 0),
      totalDuration: String(staticCourse.duration || 0),
      modules: staticModules.map((mod, mIdx) => ({
        id: mod.id,
        title: isNL && mod.titleNL ? `Module ${mIdx + 1}: ${mod.titleNL}` : `Module ${mIdx + 1}: ${mod.title}`,
        lessons: (mod.lessons || []).map(les => ({
          id: les.id,
          title: isNL && les.titleNL ? les.titleNL : les.title,
          duration: les.duration || '10:00',
          type: les.type as any,
          transcript: les.transcript,
          keyTakeaways: les.keyTakeaways,
          videoUrl: les.videoUrl || undefined,
          resources: les.type === 'video' ? [
            { name: isNL ? 'Presentatie Slides' : 'Presentation Slides', type: 'PDF', size: '2.4 MB' },
            { name: isNL ? 'Werkblad Template' : 'Worksheet Template', type: 'XLSX', size: '156 KB' },
          ] : undefined,
        })),
      })),
    };
  }
  
  // Fallback for unknown courses
  return {
    id,
    title: 'Course',
    icon: Target,
    gradient: `linear-gradient(135deg, ${BRAND.purple}, ${BRAND.purpleDark})`,
    totalLessons: 1,
    totalDuration: '1',
    modules: [{
      id: 'fallback-m1',
      title: isNL ? 'Module 1: Introductie' : 'Module 1: Introduction',
      lessons: [{
        id: 'fallback-l1',
        title: isNL ? 'Welkom' : 'Welcome',
        duration: '5:00',
        videoUrl: sampleVideoUrl,
      }],
    }],
  };
};


// ============================================
// MAIN COMPONENT
// ============================================
const CourseLearningPlayer = () => {
  const navigate = useNavigate();
  const { slug, id: lessonIdParam } = useParams<{ slug: string; id?: string }>();
  const [searchParams] = useSearchParams();
  const { language } = useLanguage();
  const { toast } = useToast();
  
  // Use the academy user hook
  const { 
    user, 
    loading,
    completeLesson,
    isLessonCompleted: checkLessonCompleted,
    getCourseProgress,
    saveNotes: saveUserNotes,
    getNotes: getUserNotes,
    isSuperuser,
  } = useAcademyUser();
  
  const videoRef = useRef<HTMLVideoElement>(null);
  const playerContainerRef = useRef<HTMLDivElement>(null);
  
  // Video state
  const [isPlaying, setIsPlaying] = useState(false);
  const [isMuted, setIsMuted] = useState(false);
  const [volume, setVolume] = useState(80);
  const [currentTime, setCurrentTime] = useState(0);
  const [duration, setDuration] = useState(0);
  const [playbackSpeed, setPlaybackSpeed] = useState(1);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [showControls, setShowControls] = useState(true);
  const [isBuffering, setIsBuffering] = useState(false);
  
  // UI state
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [activeTab, setActiveTab] = useState('content');
  const [notes, setNotes] = useState('');
  const [question, setQuestion] = useState('');
  const [currentLessonId, setCurrentLessonId] = useState<string>('l1');
  const [completionDialogOpen, setCompletionDialogOpen] = useState(false);
  const [certificateDialogOpen, setCertificateDialogOpen] = useState(false);
  const [transcriptModalOpen, setTranscriptModalOpen] = useState(false);
  const [leftSidebarOpen, setLeftSidebarOpen] = useState(true);
  const [rightSidebarOpen, setRightSidebarOpen] = useState(true);

  const isNL = language === 'nl';
  const course = getCourseData(slug || '', isNL);
  
  // Get all lessons flat
  const allLessons = course.modules.flatMap(m => m.lessons);
  
  // Initialize lesson from URL param
  useEffect(() => {
    const lessonParam = searchParams.get('lesson');
    if (lessonParam && allLessons.some(l => l.id === lessonParam)) {
      setCurrentLessonId(lessonParam);
    }
  }, [searchParams]);
  
  // Find current lesson
  const currentLesson = allLessons.find(l => l.id === currentLessonId) || allLessons[0];
  const currentLessonIndex = allLessons.findIndex(l => l.id === currentLessonId);
  const currentModuleIndex = course.modules.findIndex(m => m.lessons.some(l => l.id === currentLessonId));
  const currentModule = course.modules[currentModuleIndex];
  
  // Get progress from hook
  const progress = getCourseProgress(course.id);
  const completedCount = Math.round((progress / 100) * allLessons.length);
  
  // Check if lesson is completed using hook
  const isLessonCompleted = (lessonId: string) => checkLessonCompleted(course.id, lessonId);
  
  // Check if module is completed
  const isModuleCompleted = (moduleId: string) => {
    const module = course.modules.find(m => m.id === moduleId);
    if (!module) return false;
    return module.lessons.every(l => isLessonCompleted(l.id));
  };

  const content = {
    tabs: {
      content: isNL ? 'Inhoud' : 'Content',
      notes: isNL ? 'Notities' : 'Notes',
      resources: isNL ? 'Resources' : 'Resources',
      qa: isNL ? 'Vragen' : 'Q&A',
    },
    labels: {
      courseContent: isNL ? 'Cursusinhoud' : 'Course Content',
      yourProgress: isNL ? 'Jouw Voortgang' : 'Your Progress',
      completed: isNL ? 'voltooid' : 'completed',
      markComplete: isNL ? 'Markeer als voltooid' : 'Mark as complete',
      markedComplete: isNL ? 'Voltooid ‚úì' : 'Completed ‚úì',
      nextLesson: isNL ? 'Volgende Les' : 'Next Lesson',
      prevLesson: isNL ? 'Vorige Les' : 'Previous Lesson',
      askAI: isNL ? 'Vraag aan AI' : 'Ask AI',
      saveNotes: isNL ? 'Notities Opslaan' : 'Save Notes',
      notesPlaceholder: isNL ? 'Schrijf hier je notities...' : 'Write your notes here...',
      questionPlaceholder: isNL ? 'Stel een vraag over deze les...' : 'Ask a question about this lesson...',
      downloadResources: isNL ? 'Download Materiaal' : 'Download Resources',
      transcript: isNL ? 'Transcript' : 'Transcript',
      viewTranscript: isNL ? 'Bekijk Transcript' : 'View Transcript',
      certificate: isNL ? 'Download Certificaat' : 'Download Certificate',
      backToCourse: isNL ? 'Terug naar Cursus' : 'Back to Course',
      congratulations: isNL ? 'Gefeliciteerd!' : 'Congratulations!',
      lessonCompleted: isNL ? 'Les voltooid!' : 'Lesson completed!',
      courseCompleted: isNL ? 'Cursus voltooid!' : 'Course completed!',
      getCertificate: isNL ? 'Download Certificaat' : 'Get Certificate',
      continueToNext: isNL ? 'Naar volgende les' : 'Continue to next lesson',
      quiz: 'Quiz',
      assignment: isNL ? 'Opdracht' : 'Assignment',
      exam: isNL ? 'Examen' : 'Exam',
    },
    defaultResources: [
      { name: isNL ? 'Presentatie Slides' : 'Presentation Slides', type: 'PDF', size: '2.4 MB' },
      { name: isNL ? 'Werkblad Template' : 'Worksheet Template', type: 'XLSX', size: '156 KB' },
      { name: isNL ? 'Checklist' : 'Checklist', type: 'PDF', size: '89 KB' },
    ],
  };

  // Load saved notes for this lesson
  useEffect(() => {
    const savedNotes = getUserNotes(course.id, currentLessonId);
    setNotes(savedNotes);
  }, [currentLessonId, course.id]);

  // Video event handlers
  const handlePlay = () => setIsPlaying(true);
  const handlePause = () => setIsPlaying(false);
  const handleTimeUpdate = () => {
    if (videoRef.current) {
      setCurrentTime(videoRef.current.currentTime);
    }
  };
  const handleLoadedMetadata = () => {
    if (videoRef.current) {
      setDuration(videoRef.current.duration);
    }
  };
  const handleWaiting = () => setIsBuffering(true);
  const handleCanPlay = () => setIsBuffering(false);
  const handleEnded = () => {
    setIsPlaying(false);
    if (!isLessonCompleted(currentLessonId)) {
      setCompletionDialogOpen(true);
    }
  };

  // Video controls
  const togglePlay = () => {
    if (videoRef.current) {
      if (isPlaying) {
        videoRef.current.pause();
      } else {
        videoRef.current.play();
      }
    }
  };

  const handleSeek = (value: number[]) => {
    if (videoRef.current) {
      videoRef.current.currentTime = value[0];
      setCurrentTime(value[0]);
    }
  };

  const handleVolumeChange = (value: number[]) => {
    if (videoRef.current) {
      videoRef.current.volume = value[0] / 100;
      setVolume(value[0]);
      setIsMuted(value[0] === 0);
    }
  };

  const toggleMute = () => {
    if (videoRef.current) {
      videoRef.current.muted = !isMuted;
      setIsMuted(!isMuted);
    }
  };

  const changePlaybackSpeed = (speed: number) => {
    if (videoRef.current) {
      videoRef.current.playbackRate = speed;
      setPlaybackSpeed(speed);
    }
  };

  const toggleFullscreen = async () => {
    if (!playerContainerRef.current) return;
    
    try {
      if (!isFullscreen) {
        await playerContainerRef.current.requestFullscreen();
        setIsFullscreen(true);
      } else {
        await document.exitFullscreen();
        setIsFullscreen(false);
      }
    } catch (error) {
      console.error('Fullscreen error:', error);
    }
  };

  const formatTime = (seconds: number) => {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  // Mark lesson as complete
  const markAsComplete = () => {
    const newProgress = completeLesson(course.id, currentLessonId, allLessons.length);
    
    toast({
      title: content.labels.lessonCompleted,
      description: isNL ? 'Je voortgang is opgeslagen.' : 'Your progress has been saved.',
    });
    
    // Check if course is complete
    if (newProgress === 100) {
      setCertificateDialogOpen(true);
    } else {
      setCompletionDialogOpen(true);
    }
  };

  // Navigate to lesson
  const goToLesson = (lessonId: string) => {
    setCurrentLessonId(lessonId);
    setCurrentTime(0);
    setIsPlaying(false);
    if (videoRef.current) {
      videoRef.current.currentTime = 0;
    }
    // Update URL
    navigate(`/academy/course/${course.id}/learn?lesson=${lessonId}`, { replace: true });
  };

  const goToNextLesson = () => {
    if (currentLessonIndex < allLessons.length - 1) {
      goToLesson(allLessons[currentLessonIndex + 1].id);
    }
  };

  const goToPrevLesson = () => {
    if (currentLessonIndex > 0) {
      goToLesson(allLessons[currentLessonIndex - 1].id);
    }
  };

  // Save notes
  const handleSaveNotes = () => {
    saveUserNotes(course.id, currentLessonId, notes);
    toast({
      title: isNL ? 'Notities opgeslagen' : 'Notes saved',
      description: isNL ? 'Je notities zijn opgeslagen.' : 'Your notes have been saved.',
    });
  };

  // Ask AI
  const askAI = () => {
    if (question.trim()) {
      toast({
        title: isNL ? 'AI Assistent' : 'AI Assistant',
        description: isNL ? 'Je vraag wordt verwerkt...' : 'Processing your question...',
      });
      setQuestion('');
    }
  };

  // Control visibility
  useEffect(() => {
    let timeout: NodeJS.Timeout;
    const handleMouseMove = () => {
      setShowControls(true);
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        if (isPlaying) setShowControls(false);
      }, 3000);
    };
    
    document.addEventListener('mousemove', handleMouseMove);
    return () => {
      document.removeEventListener('mousemove', handleMouseMove);
      clearTimeout(timeout);
    };
  }, [isPlaying]);

  // Keyboard shortcuts
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.target instanceof HTMLTextAreaElement || e.target instanceof HTMLInputElement) return;
      
      switch (e.key) {
        case ' ':
          e.preventDefault();
          togglePlay();
          break;
        case 'ArrowRight':
          if (videoRef.current) videoRef.current.currentTime += 10;
          break;
        case 'ArrowLeft':
          if (videoRef.current) videoRef.current.currentTime -= 10;
          break;
        case 'f':
          toggleFullscreen();
          break;
        case 'm':
          toggleMute();
          break;
      }
    };
    
    document.addEventListener('keydown', handleKeyDown);
    return () => document.removeEventListener('keydown', handleKeyDown);
  }, [isPlaying]);

  // Loading state
  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>
    );
  }

  // Not logged in - redirect
  if (!user?.isLoggedIn) {
    navigate('/login');
    return null;
  }

  return (
    <div className="min-h-screen bg-background flex flex-col">
      {/* Top Navigation */}
      <nav className="h-14 bg-card border-b border-border flex items-center justify-between px-4 shrink-0 z-50">
        <div className="flex items-center gap-4">
          <Button variant="ghost" size="sm" onClick={() => navigate(`/academy/course/${slug}`)}>
            <ChevronLeft className="w-4 h-4 mr-1" />
            {content.labels.backToCourse}
          </Button>
          <div className="hidden md:block">
            <ProjeXtPalLogo size="sm" />
          </div>
        </div>
        
        <div className="flex-1 max-w-xl mx-4 hidden md:block">
          <div className="flex items-center gap-3">
            <span className="text-sm font-medium truncate">{course.title}</span>
            <Badge variant="outline" className="shrink-0">
              {completedCount}/{allLessons.length} {content.labels.completed}
            </Badge>
          </div>
          <Progress value={progress} className="h-1.5 mt-1" />
        </div>

        <div className="flex items-center gap-2">
          {isSuperuser && (
            <Badge className="bg-red-500 text-white border-0">
              <Crown className="w-3 h-3 mr-1" /> Admin
            </Badge>
          )}
          {user?.hasSubscription && !isSuperuser && (
            <Badge className="bg-yellow-500/20 text-yellow-600 border-yellow-500/30">
              <Crown className="w-3 h-3 mr-1" />
              Pro
            </Badge>
          )}
          <Button variant="ghost" size="icon" onClick={() => setLeftSidebarOpen(!leftSidebarOpen)}>
            {leftSidebarOpen ? <ChevronLeft className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
          </Button>
          <Button variant="ghost" size="icon" onClick={() => setRightSidebarOpen(!rightSidebarOpen)}>
            {rightSidebarOpen ? <ChevronRight className="w-5 h-5" /> : <Bot className="w-5 h-5" />}
          </Button>
        </div>
      </nav>

      {/* Main Content - 3 Column Layout */}
      <div className="flex-1 flex overflow-hidden">
        
        {/* LEFT SIDEBAR - Vertical Tabs */}
        {leftSidebarOpen && (
          <aside className="w-64 bg-card border-r border-border overflow-y-auto">
            <div className="p-4">
              <h3 className="font-bold text-sm mb-4">{course.title}</h3>
              
              {/* Vertical Tab Menu */}
              <div className="space-y-1">
                <button
                  onClick={() => setActiveTab('content')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'content' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <BookOpen className="w-4 h-4" />
                  <span>Inhoud</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('notes')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'notes' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <FileText className="w-4 h-4" />
                  <span>Notities</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('resources')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'resources' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <Download className="w-4 h-4" />
                  <span>Resources</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('qa')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'qa' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <MessageSquare className="w-4 h-4" />
                  <span>Vragen</span>
                </button>

                <div className="border-t border-border my-2"></div>
                
                <button
                  onClick={() => setActiveTab('skills')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'skills' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <Target className="w-4 h-4" />
                  <span>Skills</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('simulation')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'simulation' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <FlaskConical className="w-4 h-4" />
                  <span>Simulatie</span>
                </button>
                
                <button
                  onClick={() => setActiveTab('practice')}
                  className={`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors ${
                    activeTab === 'practice' 
                      ? 'bg-primary text-primary-foreground' 
                      : 'hover:bg-muted'
                  }`}
                >
                  <Briefcase className="w-4 h-4" />
                  <span>Praktijk</span>
                </button>
              </div>
            </div>
          </aside>
        )}

        {/* CENTER - Video & Content */}
        <div className="flex-1 flex flex-col overflow-hidden">
        {/* Video Player Area */}
        <div className={`flex-1 flex flex-col transition-all duration-300 ${sidebarOpen ? 'lg:mr-96' : ''}`}>
          
          {/* Video Container - only show when there's actual video or special content */}
          {(currentLesson.videoUrl || currentLesson.type === 'quiz' || currentLesson.type === 'assignment' || currentLesson.type === 'certificate') && (
          <div 
            ref={playerContainerRef}
            className={`relative w-full group ${currentLesson.videoUrl ? 'bg-black aspect-video' : ''}`}
            onMouseEnter={() => setShowControls(true)}
          >
            {/* Video Element */}
            {currentLesson.videoUrl ? (
              <video
                ref={videoRef}
                src={currentLesson.videoUrl}
                className="w-full h-full"
                onPlay={handlePlay}
                onPause={handlePause}
                onTimeUpdate={handleTimeUpdate}
                onLoadedMetadata={handleLoadedMetadata}
                onWaiting={handleWaiting}
                onCanPlay={handleCanPlay}
                onEnded={handleEnded}
                onClick={togglePlay}
              />
            ) : (
              // Quiz/Assignment/Certificate - full width layout
              <div className="absolute inset-0 overflow-y-auto bg-white dark:bg-gray-950">
                <div className="min-h-full">
                  {currentLesson.type === 'quiz' && (
                    <QuizEngine
                      lessonId={currentLesson.id}
                      courseSlug={slug || ''}
                      apiBase=""
                      language={isNL ? 'nl' : 'en'}
                      onComplete={(passed, score) => {
                        if (passed) {
                          completeLesson(currentLesson.id);
                        }
                      }}
                    />
                  )}
                  {currentLesson.type === 'assignment' && (
                    <Button className="mt-4 text-white" style={{ background: course.gradient }}>
                      {isNL ? 'Bekijk Opdracht' : 'View Assignment'}
                    </Button>
                  )}
                  {currentLesson.type === 'certificate' && progress === 100 && (
                    <Button className="mt-4 text-white" style={{ background: course.gradient }}>
                      <Award className="w-4 h-4 mr-2" />
                      {content.labels.certificate}
                    </Button>
                  )}
                  {currentLesson.type === 'certificate' && progress < 100 && (
                    <p className="text-white/70 mt-4">
                      {isNL 
                        ? `Voltooi alle lessen om je certificaat te ontvangen (${progress}% voltooid)`
                        : `Complete all lessons to receive your certificate (${progress}% completed)`}
                    </p>
                  )}
                </div>
              </div>
            )}

            {/* Buffering Indicator */}
            {isBuffering && (
              <div className="absolute inset-0 flex items-center justify-center bg-black/50">
                <Loader2 className="w-12 h-12 text-white animate-spin" />
              </div>
            )}

            {/* Video Controls Overlay */}
            {currentLesson.videoUrl && (
              <div 
                className={`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 transition-opacity duration-300 ${
                  showControls ? 'opacity-100' : 'opacity-0'
                }`}
              >
                {/* Progress Bar */}
                <div className="mb-3">
                  <Slider
                    value={[currentTime]}
                    max={duration || 100}
                    step={0.1}
                    onValueChange={handleSeek}
                    className="cursor-pointer"
                  />
                </div>

                {/* Controls */}
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <Button 
                      variant="ghost" 
                      size="icon" 
                      className="text-white hover:bg-white/20" 
                      onClick={goToPrevLesson}
                      disabled={currentLessonIndex === 0}
                    >
                      <SkipBack className="w-5 h-5" />
                    </Button>
                    <Button 
                      variant="ghost" 
                      size="icon" 
                      className="text-white hover:bg-white/20 w-12 h-12" 
                      onClick={togglePlay}
                    >
                      {isPlaying ? <Pause className="w-6 h-6" /> : <Play className="w-6 h-6 ml-0.5" />}
                    </Button>
                    <Button 
                      variant="ghost" 
                      size="icon" 
                      className="text-white hover:bg-white/20" 
                      onClick={goToNextLesson}
                      disabled={currentLessonIndex === allLessons.length - 1}
                    >
                      <SkipForward className="w-5 h-5" />
                    </Button>
                    
                    <div className="flex items-center gap-2 ml-2">
                      <Button variant="ghost" size="icon" className="text-white hover:bg-white/20" onClick={toggleMute}>
                        {isMuted ? <VolumeX className="w-5 h-5" /> : <Volume2 className="w-5 h-5" />}
                      </Button>
                      <div className="w-24 hidden sm:block">
                        <Slider
                          value={[isMuted ? 0 : volume]}
                          max={100}
                          step={1}
                          onValueChange={handleVolumeChange}
                        />
                      </div>
                    </div>

                    <span className="text-white text-sm ml-4">
                      {formatTime(currentTime)} / {formatTime(duration)}
                    </span>
                  </div>

                  <div className="flex items-center gap-2">
                    <select 
                      value={playbackSpeed}
                      onChange={(e) => changePlaybackSpeed(Number(e.target.value))}
                      className="bg-transparent text-white text-sm border border-white/30 rounded px-2 py-1 cursor-pointer"
                    >
                      <option value={0.5} className="text-black">0.5x</option>
                      <option value={0.75} className="text-black">0.75x</option>
                      <option value={1} className="text-black">1x</option>
                      <option value={1.25} className="text-black">1.25x</option>
                      <option value={1.5} className="text-black">1.5x</option>
                      <option value={2} className="text-black">2x</option>
                    </select>
                    <Button 
                      variant="ghost" 
                      size="icon" 
                      className="text-white hover:bg-white/20"
                      onClick={toggleFullscreen}
                    >
                      {isFullscreen ? <Minimize className="w-5 h-5" /> : <Maximize className="w-5 h-5" />}
                    </Button>
                  </div>
                </div>
              </div>
            )}

            {/* Center Play Button (when paused) */}
            {!isPlaying && currentLesson.videoUrl && !isBuffering && (
              <div 
                className="absolute inset-0 flex items-center justify-center cursor-pointer"
                onClick={togglePlay}
              >
                <div 
                  className="w-20 h-20 rounded-full flex items-center justify-center bg-white/20 hover:bg-white/30 transition-colors"
                >
                  <Play className="w-10 h-10 text-white ml-1" />
                </div>
              </div>
            )}
          </div>
          )}

          {/* Below Video Content */}
          <div className="flex-1 overflow-auto p-6">
            <div className="max-w-4xl">
              {/* Lesson Title & Actions */}
              <div className="flex items-start justify-between mb-6 flex-wrap gap-4">
                <div>
                  <div className="flex items-center gap-2 mb-2">
                    {isLessonCompleted(currentLessonId) && (
                      <Badge className="bg-green-100 text-green-700 border-green-200">
                        <CheckCircle2 className="w-3 h-3 mr-1" />
                        {isNL ? 'Voltooid' : 'Completed'}
                      </Badge>
                    )}
                    {currentLesson.type === 'quiz' && <Badge variant="outline">{content.labels.quiz}</Badge>}
                    {currentLesson.type === 'assignment' && <Badge variant="outline">{content.labels.assignment}</Badge>}
                  </div>
                  <h1 className="text-2xl font-bold mb-2">{currentLesson.title}</h1>
                  <p className="text-muted-foreground">
                    {currentModule?.title} ‚Ä¢ {isNL ? 'Les' : 'Lesson'} {getLessonGlobalIndex(course.modules, currentLessonId)} {isNL ? 'van' : 'of'} {allLessons.length}
                  </p>
                </div>
                <div className="flex gap-2">
                  {currentLesson.transcript && (
                    <Button 
                      variant="outline" 
                      size="sm"
                      onClick={() => setTranscriptModalOpen(true)}
                    >
                      <FileText className="w-4 h-4 mr-2" />
                      {content.labels.viewTranscript}
                    </Button>
                  )}
                  <Button variant="outline" size="sm" onClick={() => {
                      const noteEl = document.querySelector('textarea');
                      if (noteEl) {
                        const noteText = (noteEl as HTMLTextAreaElement).value;
                        saveUserNotes(currentLesson.id, noteText);
                        toast({ title: isNL ? 'Opgeslagen!' : 'Saved!', description: isNL ? 'Je notities zijn opgeslagen.' : 'Your notes have been saved.' });
                      } else {
                        toast({ title: isNL ? 'Opgeslagen!' : 'Saved!', description: isNL ? 'Les opgeslagen als bladwijzer.' : 'Lesson bookmarked.' });
                      }
                    }}>
                      <Bookmark className="w-4 h-4 mr-2" />
                      {isNL ? 'Opslaan' : 'Save'}
                    </Button>
                  <Button variant="outline" size="sm" onClick={() => {
                      const url = window.location.href;
                      navigator.clipboard.writeText(url).then(() => {
                        toast({ title: isNL ? 'Link gekopieerd!' : 'Link copied!', description: url });
                      }).catch(() => {
                        toast({ title: isNL ? 'Deel deze link:' : 'Share this link:', description: url });
                      });
                    }}>
                      <Share2 className="w-4 h-4 mr-2" />
                      {isNL ? 'Delen' : 'Share'}
                    </Button>
                </div>
              </div>

              {/* Tabs */}
              <Tabs value={activeTab} onValueChange={setActiveTab}>
                <TabsList className="mb-6">
  <TabsTrigger value="content">{content.tabs.content}</TabsTrigger>
  <TabsTrigger value="notes">{content.tabs.notes}</TabsTrigger>
  <TabsTrigger value="resources">{content.tabs.resources}</TabsTrigger>
  <TabsTrigger value="qa">{content.tabs.qa}</TabsTrigger>
  <TabsTrigger value="aicoach">
    <Bot className="w-4 h-4 mr-2" />
    {isNL ? 'AI Coach' : 'AI Coach'}
  </TabsTrigger>
  <TabsTrigger value="skills">
    <Target className="w-4 h-4 mr-2" />
    {isNL ? 'Skills' : 'Skills'}
  </TabsTrigger>
  <TabsTrigger value="simulation">
    <FlaskConical className="w-4 h-4 mr-2" />
    {isNL ? 'Simulatie' : 'Simulation'}
  </TabsTrigger>
  <TabsTrigger value="practice">
    <Briefcase className="w-4 h-4 mr-2" />
    {isNL ? 'Praktijk' : 'Practice'}
  </TabsTrigger>
</TabsList>

                <TabsContent value="content" className="space-y-6">
                  <div className="prose dark:prose-invert max-w-none">
                    <h3>{isNL ? 'Over deze les' : 'About this lesson'}</h3>
                    {currentLesson.transcript ? (
                      renderMarkdownBlock(currentLesson.transcript)
                    ) : (
                      <p>{isNL
                        ? 'In deze les leer je belangrijke concepten die direct toepasbaar zijn in je projecten.'
                        : 'In this lesson you will learn important concepts that are directly applicable to your projects.'}</p>
                    )}
                  </div>

                  {/* Action Buttons */}
                  <div className="flex flex-wrap gap-3 pt-4 border-t">
                    {isLessonCompleted(currentLessonId) ? (
                      <Button 
                        variant="outline"
                        disabled
                        className="text-green-600 border-green-200"
                      >
                        <CheckCircle2 className="w-4 h-4 mr-2" />
                        {content.labels.markedComplete}
                      </Button>
                    ) : (
                      <Button 
                        onClick={markAsComplete}
                        className="text-white"
                        style={{ background: `linear-gradient(135deg, ${BRAND.green}, ${BRAND.greenDark})` }}
                      >
                        <CheckCircle2 className="w-4 h-4 mr-2" />
                        {content.labels.markComplete}
                      </Button>
                    )}
                    {currentLessonIndex < allLessons.length - 1 && (
                      <Button variant="outline" onClick={goToNextLesson}>
                        {content.labels.nextLesson}
                        <ChevronRight className="w-4 h-4 ml-2" />
                      </Button>
                    )}
                  </div>
                </TabsContent>

                <TabsContent value="notes" className="space-y-4">
                  <Textarea 
                    placeholder={content.labels.notesPlaceholder}
                    value={notes}
                    onChange={(e) => setNotes(e.target.value)}
                    className="min-h-[200px]"
                  />
                  <Button 
                    onClick={handleSaveNotes}
                    className="text-white"
                    style={{ background: `linear-gradient(135deg, ${BRAND.purple}, ${BRAND.pink})` }}
                  >
                    {content.labels.saveNotes}
                  </Button>
                </TabsContent>

                <TabsContent value="resources" className="space-y-4">
                  {(currentLesson.resources || content.defaultResources).map((resource, i) => (
                    <Card key={i} className="hover:shadow-md transition-shadow">
                      <CardContent className="p-4 flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="p-2 rounded-lg bg-muted">
                            <FileText className="w-5 h-5" style={{ color: BRAND.purple }} />
                          </div>
                          <div>
                            <p className="font-medium">{resource.name}</p>
                            <p className="text-sm text-muted-foreground">{resource.type} ‚Ä¢ {resource.size}</p>
                          </div>
                        </div>
                        <Button variant="outline" size="sm" onClick={() => {
                          if (resource.url) {
                            window.open(resource.url, '_blank');
                          } else {
                            toast({ 
                              title: isNL ? 'Download niet beschikbaar' : 'Download not available',
                              description: isNL ? 'Dit materiaal wordt binnenkort toegevoegd.' : 'This material will be added soon.',
                              variant: 'destructive'
                            });
                          }
                        }}>
                          <Download className="w-4 h-4 mr-2" />
                          {isNL ? 'Downloaden' : 'Download'}
                        </Button>
                      </CardContent>
                    </Card>
                  ))}
                </TabsContent>
                <TabsContent value="aicoach" className="space-y-4">
                  <Card className="bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-2 border-purple-200 dark:border-purple-800">
                    <CardContent className="p-6">
                      <div className="flex items-start gap-4">
                        <div className="p-3 rounded-xl bg-gradient-to-br from-purple-600 to-pink-600 shadow-lg">
                          <Bot className="w-6 h-6 text-white" />
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2 flex items-center gap-2">
                            {isNL ? 'ü§ñ AI Coach - Persoonlijke Begeleiding' : 'ü§ñ AI Coach - Personal Guidance'}
                          </h4>
                          <p className="text-sm text-muted-foreground mb-4">
                            {isNL 
                              ? 'Stel vragen, krijg uitleg op maat van jouw sector en rol. De AI Coach begrijpt jouw context.'
                              : 'Ask questions, get explanations tailored to your sector and role. The AI Coach understands your context.'}
                          </p>
                          
                          {/* Chat Interface */}
                          <div className="bg-white dark:bg-gray-900 rounded-lg p-4 mb-4 max-h-96 overflow-y-auto space-y-3">
                            {/* Example messages */}
                            <div className="flex items-start gap-3">
                              <div className="w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900 flex items-center justify-center shrink-0">
                                <Bot className="w-4 h-4 text-purple-600 dark:text-purple-400" />
                              </div>
                              <div className="bg-purple-50 dark:bg-purple-900/30 rounded-lg p-3 flex-1">
                                <p className="text-sm">
                                  {isNL 
                                    ? 'Hallo! Ik ben je AI Coach. Ik help je deze les te begrijpen vanuit jouw perspectief. Wat wil je weten?'
                                    : 'Hello! I\'m your AI Coach. I help you understand this lesson from your perspective. What would you like to know?'}
                                </p>
                              </div>
                            </div>
                          </div>

                          {/* Input */}
                          <div className="flex gap-2">
                            <Textarea 
                              placeholder={isNL 
                                ? 'Bijv: "Hoe pas ik dit toe in de zorg?" of "Kan je dit uitleggen met een IT voorbeeld?"'
                                : 'E.g: "How do I apply this in healthcare?" or "Can you explain this with an IT example?"'
                              }
                              className="flex-1 min-h-[80px]"
                            />
                          </div>
                          <Button 
                            className="text-white mt-3"
                            style={{ background: `linear-gradient(135deg, ${BRAND.purple}, ${BRAND.pink})` }}
                          >
                            <Bot className="w-4 h-4 mr-2" />
                            {isNL ? 'Vraag AI Coach' : 'Ask AI Coach'}
                          </Button>
                        </div>
                      </div>
                    </CardContent>
                  </Card>

                  {/* Quick questions */}
                  <div>
                    <h4 className="font-medium mb-3 text-sm text-muted-foreground">
                      {isNL ? 'Snelle vragen:' : 'Quick questions:'}
                    </h4>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                      {[
                        isNL ? 'Geef een praktijkvoorbeeld' : 'Give a practical example',
                        isNL ? 'Hoe implementeer ik dit?' : 'How do I implement this?',
                        isNL ? 'Wat zijn de risico\'s?' : 'What are the risks?',
                        isNL ? 'Test mijn begrip' : 'Test my understanding'
                      ].map((q, i) => (
                        <Button key={i} variant="outline" size="sm" className="justify-start text-left h-auto py-2">
                          <Sparkles className="w-3 h-3 mr-2 shrink-0" />
                          <span className="text-xs">{q}</span>
                        </Button>
                      ))}
                    </div>
                  </div>
                </TabsContent>

                <TabsContent value="skills" className="space-y-4">
                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-start gap-4 mb-6">
                        <div className="p-3 rounded-xl bg-gradient-to-br from-green-600 to-emerald-600 shadow-lg">
                          <Target className="w-6 h-6 text-white" />
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2">
                            {isNL ? 'üéØ Skills Ontwikkeling' : 'üéØ Skills Development'}
                          </h4>
                          <p className="text-sm text-muted-foreground">
                            {isNL 
                              ? 'Deze les ontwikkelt de volgende competenties in jouw Skills Paspoort:'
                              : 'This lesson develops the following competencies in your Skills Passport:'}
                          </p>
                        </div>
                      </div>

                      {/* Skills being developed */}
                      <div className="space-y-3">
                        {[
                          { skill: isNL ? 'Project Planning' : 'Project Planning', current: 60, gain: 15, icon: 'üìä' },
                          { skill: isNL ? 'Stakeholder Management' : 'Stakeholder Management', current: 45, gain: 10, icon: 'üë•' },
                          { skill: isNL ? 'Risk Assessment' : 'Risk Assessment', current: 30, gain: 20, icon: '‚ö†Ô∏è' }
                        ].map((item, i) => (
                          <div key={i} className="bg-muted/50 rounded-lg p-4">
                            <div className="flex items-center justify-between mb-2">
                              <span className="font-medium text-sm flex items-center gap-2">
                                <span>{item.icon}</span>
                                {item.skill}
                              </span>
                              <Badge variant="outline" className="bg-green-50 text-green-700 border-green-200">
                                +{item.gain}%
                              </Badge>
                            </div>
                            <div className="flex items-center gap-3">
                              <Progress value={item.current} className="flex-1 h-2" />
                              <span className="text-xs text-muted-foreground w-12 text-right">
                                {item.current}%
                              </span>
                            </div>
                            <p className="text-xs text-muted-foreground mt-2">
                              {isNL ? 'Na voltooiing:' : 'After completion:'} {item.current + item.gain}%
                            </p>
                          </div>
                        ))}
                      </div>

                      {/* View full passport */}
                      <Button variant="outline" className="w-full mt-4">
                        <GraduationCap className="w-4 h-4 mr-2" />
                        {isNL ? 'Bekijk Volledig Skills Paspoort' : 'View Full Skills Passport'}
                      </Button>
                    </CardContent>
                  </Card>
                </TabsContent>

                <TabsContent value="simulation" className="space-y-4">
                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-start gap-4 mb-6">
                        <div className="p-3 rounded-xl bg-gradient-to-br from-blue-600 to-cyan-600 shadow-lg">
                          <FlaskConical className="w-6 h-6 text-white" />
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2">
                            {isNL ? 'üß™ Interactieve Simulatie' : 'üß™ Interactive Simulation'}
                          </h4>
                          <p className="text-sm text-muted-foreground">
                            {isNL 
                              ? 'Oefen met realistische scenario\'s en zie direct de impact van jouw beslissingen.'
                              : 'Practice with realistic scenarios and see the immediate impact of your decisions.'}
                          </p>
                        </div>
                      </div>

                      {/* Simulation preview */}
                      <div className="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl p-6 border-2 border-blue-200 dark:border-blue-800">
                        <div className="text-center mb-4">
                          <div className="w-16 h-16 rounded-full bg-gradient-to-br from-blue-600 to-cyan-600 flex items-center justify-center mx-auto mb-3 shadow-lg">
                            <FlaskConical className="w-8 h-8 text-white" />
                          </div>
                          <h5 className="font-bold mb-2">
                            {isNL ? 'Simulatie: Risk Escalation' : 'Simulation: Risk Escalation'}
                          </h5>
                          <p className="text-sm text-muted-foreground mb-4">
                            {isNL 
                              ? 'Een kritiek risico is ge√Ødentificeerd. Hoe handel je?'
                              : 'A critical risk has been identified. How do you handle it?'}
                          </p>
                        </div>

                        <div className="space-y-2">
                          <Button variant="outline" className="w-full justify-start bg-white dark:bg-gray-900">
                            <span className="font-bold mr-2">A)</span>
                            {isNL ? 'Direct escaleren naar sponsor' : 'Immediately escalate to sponsor'}
                          </Button>
                          <Button variant="outline" className="w-full justify-start bg-white dark:bg-gray-900">
                            <span className="font-bold mr-2">B)</span>
                            {isNL ? 'Eerst team raadplegen' : 'Consult team first'}
                          </Button>
                          <Button variant="outline" className="w-full justify-start bg-white dark:bg-gray-900">
                            <span className="font-bold mr-2">C)</span>
                            {isNL ? 'Mitigatie plan opstellen' : 'Create mitigation plan'}
                          </Button>
                        </div>

                        <Button 
                          className="w-full mt-4 text-white"
                          style={{ background: `linear-gradient(135deg, ${BRAND.blue}, #0ea5e9)` }}
                        >
                          <PlayCircle className="w-4 h-4 mr-2" />
                          {isNL ? 'Start Simulatie' : 'Start Simulation'}
                        </Button>
                      </div>
                    </CardContent>
                  </Card>
                </TabsContent>

                <TabsContent value="practice" className="space-y-4">
                  <Card>
                    <CardContent className="p-6">
                      <div className="flex items-start gap-4 mb-6">
                        <div className="p-3 rounded-xl bg-gradient-to-br from-orange-600 to-red-600 shadow-lg">
                          <Briefcase className="w-6 h-6 text-white" />
                        </div>
                        <div className="flex-1">
                          <h4 className="font-bold text-lg mb-2">
                            {isNL ? 'üíº Praktijkopdracht' : 'üíº Practice Assignment'}
                          </h4>
                          <p className="text-sm text-muted-foreground">
                            {isNL 
                              ? 'Pas de theorie toe op een echt project en bouw je portfolio.'
                              : 'Apply the theory to a real project and build your portfolio.'}
                          </p>
                        </div>
                      </div>

                      {/* Assignment */}
                      <div className="bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-xl p-6 border-2 border-orange-200 dark:border-orange-800 mb-4">
                        <h5 className="font-bold mb-3 flex items-center gap-2">
                          <Briefcase className="w-5 h-5 text-orange-600" />
                          {isNL ? 'Opdracht: Project Charter Opstellen' : 'Assignment: Create Project Charter'}
                        </h5>
                        <p className="text-sm mb-4">
                          {isNL 
                            ? 'Maak een project charter voor een project binnen jouw organisatie. Gebruik het template en pas de geleerde concepten toe.'
                            : 'Create a project charter for a project within your organization. Use the template and apply the learned concepts.'}
                        </p>

                        {/* Checklist */}
                        <div className="bg-white dark:bg-gray-900 rounded-lg p-4 space-y-2 mb-4">
                          <p className="font-medium text-sm mb-2">{isNL ? 'Vereisten:' : 'Requirements:'}</p>
                          {[
                            isNL ? 'Project doel en scope' : 'Project goal and scope',
                            isNL ? 'Stakeholder identificatie' : 'Stakeholder identification',
                            isNL ? 'Initi√´le risicoanalyse' : 'Initial risk analysis',
                            isNL ? 'Budget indicatie' : 'Budget indication'
                          ].map((req, i) => (
                            <div key={i} className="flex items-center gap-2 text-sm">
                              <div className="w-4 h-4 rounded border-2 border-orange-500" />
                              <span>{req}</span>
                            </div>
                          ))}
                        </div>

                        <div className="flex gap-2">
                          <Button variant="outline" className="flex-1">
                            <Download className="w-4 h-4 mr-2" />
                            {isNL ? 'Download Template' : 'Download Template'}
                          </Button>
                          <Button 
                            className="flex-1 text-white"
                            style={{ background: `linear-gradient(135deg, ${BRAND.orange}, #ef4444)` }}
                          >
                            <FileText className="w-4 h-4 mr-2" />
                            {isNL ? 'Upload Opdracht' : 'Upload Assignment'}
                          </Button>
                        </div>
                      </div>

                      {/* Link to own project */}
                      <Card className="bg-muted/30 border-dashed">
                        <CardContent className="p-4">
                          <p className="text-sm text-muted-foreground mb-3">
                            {isNL 
                              ? 'üí° Tip: Koppel deze opdracht aan een bestaand project in ProjeXtPal voor automatische templates en tracking.'
                              : 'üí° Tip: Link this assignment to an existing project in ProjeXtPal for automatic templates and tracking.'}
                          </p>
                          <Button variant="outline" size="sm">
                            <Zap className="w-4 h-4 mr-2" />
                            {isNL ? 'Koppel aan Project' : 'Link to Project'}
                          </Button>
                        </CardContent>
                      </Card>
                    </CardContent>
                  </Card>
                </TabsContent>

                <TabsContent value="qa" className="space-y-4">
                  <Card className="bg-muted/30 border-dashed">
                    <CardContent className="p-4">
                      <div className="flex items-start gap-3">
                        <div className="p-2 rounded-lg" style={{ backgroundColor: `${BRAND.purple}15` }}>
                          <Brain className="w-5 h-5" style={{ color: BRAND.purple }} />
                        </div>
                        <div className="flex-1">
                          <h4 className="font-medium mb-1">{isNL ? 'AI Assistent' : 'AI Assistant'}</h4>
                          <p className="text-sm text-muted-foreground mb-3">
                            {isNL ? 'Stel een vraag over deze les en ontvang direct antwoord.' : 'Ask a question about this lesson and get an instant answer.'}
                          </p>
                          <div className="flex gap-2">
                            <Textarea 
                              placeholder={content.labels.questionPlaceholder}
                              value={question}
                              onChange={(e) => setQuestion(e.target.value)}
                              className="flex-1 min-h-[80px]"
                            />
                          </div>
                          <Button 
                            onClick={askAI}
                            className="text-white mt-3"
                            style={{ background: `linear-gradient(135deg, ${BRAND.purple}, ${BRAND.pink})` }}
                            disabled={!question.trim()}
                          >
                            <Brain className="w-4 h-4 mr-2" />
                            {content.labels.askAI}
                          </Button>
                        </div>
                      </div>
                    </CardContent>
                  </Card>
                  
                  <div className="text-center py-8 text-muted-foreground">
                    <MessageSquare className="w-12 h-12 mx-auto mb-3 opacity-30" />
                    <p>{isNL ? 'Nog geen vragen. Stel je eerste vraag!' : 'No questions yet. Ask your first question!'}</p>
                  </div>
                </TabsContent>
              </Tabs>
            </div>
          </div>
        </div>

        {/* RIGHT SIDEBAR - AI Coach + Modules */}
        {rightSidebarOpen && (
          <aside className="hidden lg:flex lg:flex-col fixed right-0 top-14 bottom-0 w-96 bg-card border-l border-border overflow-hidden z-40">
            
            {/* AI Coach Panel - Top Half */}
            <div className="h-1/2 border-b border-border">
              <AiCoachPanel
                lessonId={currentLessonId}
                courseId={course.id}
                userContext={{
                  sector: user?.sector,
                  role: user?.role,
                  methodology: course.title.includes('PRINCE2') ? 'PRINCE2' : 'Generic'
                }}
              />
            </div>

            {/* Modules - Bottom Half */}
            <div className="flex-1 overflow-hidden flex flex-col">
              <div className="p-4 border-b border-border">
                <h2 className="font-bold">{content.labels.courseContent}</h2>
                <div className="flex items-center gap-2 mt-2">
                  <Progress value={progress} className="flex-1 h-2" />
                  <span className="text-sm text-muted-foreground">{progress}%</span>
                </div>
              </div>

              <ScrollArea className="flex-1">
                <div className="p-2">
                  <Accordion type="multiple" defaultValue={[`module-${currentModuleIndex}`]} className="space-y-1">
                    {course.modules.map((module, mIndex) => (
                      <AccordionItem key={module.id} value={`module-${mIndex}`} className="border rounded-lg px-2">
                        <AccordionTrigger className="hover:no-underline py-3">
                          <div className="flex items-center gap-3 text-left">
                            <div 
                              className={`w-7 h-7 rounded-full flex items-center justify-center text-xs font-bold ${
                                isModuleCompleted(module.id)
                                  ? 'bg-green-100 text-green-600' 
                                  : 'bg-muted text-muted-foreground'
                              }`}
                            >
                              {isModuleCompleted(module.id) ? <CheckCircle2 className="w-4 h-4" /> : mIndex + 1}
                            </div>
                            <span className="font-medium text-sm">{module.title}</span>
                          </div>
                        </AccordionTrigger>
                        <AccordionContent>
                          <div className="space-y-1 pb-2">
                            {module.lessons.map((lesson) => (
                              <button
                                key={lesson.id}
                                onClick={() => goToLesson(lesson.id)}
                                className={`w-full flex items-center gap-3 p-2 rounded-lg text-left text-sm transition-colors ${
                                  lesson.id === currentLessonId 
                                    ? 'bg-primary/10 text-primary' 
                                    : 'hover:bg-muted'
                                }`}
                              >
                                <div className="shrink-0">
                                  {isLessonCompleted(lesson.id) ? (
                                    <CheckCircle2 className="w-4 h-4" style={{ color: BRAND.green }} />
                                  ) : lesson.id === currentLessonId ? (
                                    <PlayCircle className="w-4 h-4" style={{ color: BRAND.purple }} />
                                  ) : (
                                    <Circle className="w-4 h-4 text-muted-foreground" />
                                  )}
                                </div>
                                <div className="flex-1 min-w-0">
                                  <p className={`truncate ${lesson.id === currentLessonId ? 'font-medium' : ''}`}>
                                    {lesson.title}
                                  </p>
                                  {(lesson.type === 'quiz' || lesson.type === 'assignment') && (
                                    <span className="text-xs text-muted-foreground">
                                      {lesson.type === 'quiz' && 'Quiz'}
                                      {lesson.type === 'assignment' && (isNL ? 'Opdracht' : 'Assignment')}
                                    </span>
                                  )}
                                </div>
                                <span className="text-xs text-muted-foreground shrink-0">
                                  {lesson.duration}
                                </span>
                              </button>
                            ))}
                          </div>
                        </AccordionContent>
                      </AccordionItem>
                    ))}
                  </Accordion>
                </div>
              </ScrollArea>
            </div>
          </aside>
        )}
      </div>

    {/* Transcript Modal */}
      <LessonContentModal
        isOpen={transcriptModalOpen}
        onClose={() => setTranscriptModalOpen(false)}
        lesson={currentLesson}
        courseTitle={course.title}
        onPrevLesson={currentLessonIndex > 0 ? goToPrevLesson : undefined}
        onNextLesson={currentLessonIndex < allLessons.length - 1 ? goToNextLesson : undefined}
        hasNextLesson={currentLessonIndex < allLessons.length - 1}
        hasPrevLesson={currentLessonIndex > 0}
      />

      {/* Lesson Completion Dialog */}
      <Dialog open={completionDialogOpen} onOpenChange={setCompletionDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Sparkles className="w-5 h-5" style={{ color: BRAND.green }} />
              {content.labels.congratulations}
            </DialogTitle>
            <DialogDescription>
              {content.labels.lessonCompleted}
            </DialogDescription>
          </DialogHeader>
          <div className="py-4 text-center">
            <div 
              className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"
              style={{ background: `linear-gradient(135deg, ${BRAND.green}, ${BRAND.greenDark})` }}
            >
              <CheckCircle2 className="w-10 h-10 text-white" />
            </div>
            <p className="text-muted-foreground">
              {isNL 
                ? `Je hebt ${completedCount + 1} van ${allLessons.length} lessen voltooid!`
                : `You have completed ${completedCount + 1} of ${allLessons.length} lessons!`}
            </p>
            <Progress value={Math.round(((completedCount + 1) / allLessons.length) * 100)} className="mt-4" />
          </div>
          <DialogFooter>
            <Button variant="outline" onClick={() => setCompletionDialogOpen(false)}>
              {isNL ? 'Sluiten' : 'Close'}
            </Button>
            {currentLessonIndex < allLessons.length - 1 && (
              <Button 
                onClick={() => {
                  setCompletionDialogOpen(false);
                  goToNextLesson();
                }}
                className="text-white"
                style={{ background: course.gradient }}
              >
                {content.labels.continueToNext}
                <ChevronRight className="w-4 h-4 ml-1" />
              </Button>
            )}
          </DialogFooter>
        </DialogContent>
      </Dialog>

      {/* Certificate Dialog */}
      <Dialog open={certificateDialogOpen} onOpenChange={setCertificateDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle className="flex items-center gap-2">
              <Trophy className="w-5 h-5" style={{ color: BRAND.orange }} />
              {content.labels.courseCompleted}
            </DialogTitle>
          </DialogHeader>
          <div className="py-6 text-center">
            <div 
              className="w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4"
              style={{ background: `linear-gradient(135deg, ${BRAND.orange}, ${BRAND.pink})` }}
            >
              <Award className="w-12 h-12 text-white" />
            </div>
            <h3 className="text-xl font-bold mb-2">{content.labels.congratulations}</h3>
            <p className="text-muted-foreground mb-4">
              {isNL 
                ? `Je hebt "${course.title}" succesvol afgerond!`
                : `You have successfully completed "${course.title}"!`}
            </p>
          </div>
          <DialogFooter className="flex-col sm:flex-row gap-2">
            <Button variant="outline" onClick={() => setCertificateDialogOpen(false)}>
              {isNL ? 'Later' : 'Later'}
            </Button>
            <Button 
              className="text-white"
              style={{ background: `linear-gradient(135deg, ${BRAND.orange}, ${BRAND.pink})` }}
            >
              <Download className="w-4 h-4 mr-2" />
              {content.labels.getCertificate}
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
    </div>
  );
};

export default CourseLearningPlayer;